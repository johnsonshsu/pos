<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自助點餐</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>

    <!-- Header -->
    <div class="customer-header d-flex justify-content-between align-items-center shadow-sm">
        <h4 class="m-0"><i class="fas fa-utensils me-2"></i>自助點餐</h4>
        <a href="index.html" class="btn btn-outline-light btn-sm">回首頁</a>
    </div>

    <!-- 內用/外帶選擇 -->
    <div class="dining-option-container">
        <div class="btn-group w-100" role="group">
            <input type="radio" class="btn-check" name="diningOption" id="dineIn" value="dineIn" checked>
            <label class="btn btn-outline-primary" for="dineIn">
                <i class="fas fa-chair me-2"></i>內用
            </label>
            <input type="radio" class="btn-check" name="diningOption" id="takeOut" value="takeOut">
            <label class="btn btn-outline-primary" for="takeOut">
                <i class="fas fa-shopping-bag me-2"></i>外帶
            </label>
        </div>
    </div>

    <!-- 分類導航列 -->
    <div class="category-nav-container">
        <div class="category-nav" id="category-nav">
            <!-- Categories will be injected here by JS -->
        </div>
    </div>

    <!-- Menu Content -->
    <div id="menu-container" style="padding-bottom: 80px;">
        <!-- Items will be injected here by JS -->
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-bar">
        <div>
            <span class="total-price" id="total-price">$0</span>
            <span class="text-muted small" id="total-count">(0樣)</span>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-secondary rounded-pill" onclick="showCartDetails()">
                點餐明細
            </button>
            <button class="btn btn-success rounded-pill" onclick="generateCheckoutQR()">
                現場結帳
            </button>
            <button class="btn btn-primary rounded-pill" onclick="orderOnline()">
                線上預定
            </button>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title">點餐明細</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group" id="cart-list">
                        <!-- Cart Items -->
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">現場結帳 QR Code</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="mb-3">請至櫃台出示此 QR Code 結帳</p>
                    <div id="qrcode" class="d-flex justify-content-center my-3"></div>
                    <h4 id="qr-total" class="text-danger fw-bold mt-2"></h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Note Modal -->
    <div class="modal fade" id="noteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>商品備註</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <img id="note-product-img" src="" class="product-icon me-2" alt="">
                            <div>
                                <div id="note-product-name" class="fw-bold"></div>
                                <div id="note-product-price" class="text-danger"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">常用備註</label>
                        <div id="common-notes-container" class="d-flex flex-wrap gap-2">
                            <!-- Common notes will be injected here -->
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="custom-note" class="form-label fw-bold">自訂備註</label>
                        <textarea id="custom-note" class="form-control" rows="2" placeholder="輸入其他備註..."></textarea>
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold">已選備註</label>
                        <div id="selected-notes" class="selected-notes-display text-muted">尚未選擇備註</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveNote()">
                        <i class="fas fa-check me-1"></i>確認
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Online Reservation Input Modal -->
    <div class="modal fade" id="onlineReservationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-utensils me-2"></i>線上預定</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="reservationName" class="form-label fw-bold">姓名</label>
                        <input type="text" class="form-control" id="reservationName" placeholder="請輸入您的姓名">
                    </div>
                    <div class="mb-3">
                        <label for="reservationPhone" class="form-label fw-bold">電話號碼 (後3碼)</label>
                        <input type="tel" class="form-control" id="reservationPhone" maxlength="3" placeholder="例如: 123" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="confirmReservation()">
                        確認預定
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reservation Success Modal -->
    <div class="modal fade" id="reservationSuccessModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-success">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>預定成功</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <h6 class="text-muted">訂單編號</h6>
                        <h2 class="fw-bold text-success" id="successOrderNumber">#000000</h2>
                    </div>
                    <div class="card mb-3">
                        <div class="card-body bg-light">
                            <p class="mb-1"><strong>姓名:</strong> <span id="successName"></span></p>
                            <p class="mb-0"><strong>電話後3碼:</strong> <span id="successPhone"></span></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 class="fw-bold border-bottom pb-2">訂餐內容</h6>
                        <ul class="list-group list-group-flush" id="successOrderList">
                            <!-- Order items will be cloned here -->
                        </ul>
                    </div>
                    <div class="text-end fw-bold fs-5 text-danger border-top pt-2" id="successTotal">
                        總計: $0
                    </div>
                    <div class="alert alert-warning mt-3 small mb-0">
                        <i class="fas fa-camera me-1"></i> 請截圖或保存此畫面作為取餐憑證
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success w-100" data-bs-dismiss="modal">我已截圖保存</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="data.js"></script>
    <script src="order.js"></script>
</body>
</html>